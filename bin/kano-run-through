#!/bin/sh

# kano-run-through
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# A script for going through the initial boot flow
#

LAUNCH_WIFI_CONFIG=1
LAUNCH_UPDATER=2
LAUNCH_SETTINGS=3
REBOOT=4
LAUNCH_PROFILE=5

./kano-tutorial 0
./kano-init-flow 0
EXIT_CODE=$?

while [ $EXIT_CODE -le $LAUNCH_UPDATER ]; do

    if [ $EXIT_CODE -eq $LAUNCH_WIFI_CONFIG ]; then
       rxvt -title \'WiFi\' -e /usr/bin/kano-wifi
       ./kano-init-flow $LAUNCH_UPDATER
       EXIT_CODE=$?
    fi

    if [ $EXIT_CODE -eq $LAUNCH_UPDATER ]; then
       sudo kano-updater
       ./kano-init-flow $LAUNCH_SETTINGS
       EXIT_CODE=$?
    fi

    # If you close window, stops application crashing
    if [ $EXIT_CODE -eq 0 ]; then
       exit $?
    fi

done

if [ $EXIT_CODE -eq $LAUNCH_WIFI_CONFIG ]; then
    sudo reboot
elif [ $EXIT_CODE -eq $LAUNCH_PROFILE ]; then
    kano-login first_boot
fi
